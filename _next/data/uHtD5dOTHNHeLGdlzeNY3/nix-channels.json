{"pageProps":{"toc":[{"url":"#","text":"Overview","depth":2},{"url":"#nixpkgs-binary-cache","depth":3,"text":"Nixpkgs binary cache"},{"url":"#nixpkgs-channel","depth":3,"text":"Nixpkgs channel"}],"content":"[\"$r\",null,null,{\"children\":[[\"$r\",\"h3\",null,{\"id\":\"nixpkgs-binary-cache\",\"children\":\"Nixpkgs binary cache\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"目前 TUNA/BFSU/USTC 等并未提供 nix-darwin 的 binary cache，请使用官方源或 SJTUG。\"}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"持久配置\",\"children\":\"持久配置\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"以优先选择镜像，备选源站为例，选择以下配置之一：\"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"单独安装的 Nix：编辑配置文件添加或修改如下项（多用户安装修改 \",[\"$r\",\"code\",null,{\"children\":\"/etc/nix/nix.conf\"}],\"，单用户安装修改 \",[\"$r\",\"code\",null,{\"children\":\"~/.config/nix/nix.conf\"}],\"）：\"]}],\"\\n\",[\"$r\",\"CodeBlock\",null,{\"code\":\"substituters = {{http_protocol}}{{mirror}}/store https://cache.nixos.org/\"}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"NixOS 21.11 及之前的版本在 \",[\"$r\",\"code\",null,{\"children\":\"configuration.nix\"}],\" 中使用如下配置（\",[\"$r\",\"a\",null,{\"href\":\"https://cache.nixos.org\",\"rel\":\"nofollow\",\"children\":\"https://cache.nixos.org\"}],\" 会被自动添加）\"]}],\"\\n\",[\"$r\",\"CodeBlock\",null,{\"code\":\"nix.binaryCaches = [ \\\"{{http_protocol}}{{mirror}}/store\\\" ];\",\"codeLanguage\":\"nix\"}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"NixOS 22.05 及之后的版本在 \",[\"$r\",\"code\",null,{\"children\":\"configuration.nix\"}],\" 中使用如下配置（\",[\"$r\",\"a\",null,{\"href\":\"https://cache.nixos.org\",\"rel\":\"nofollow\",\"children\":\"https://cache.nixos.org\"}],\" 会被自动添加）：\"]}],\"\\n\",[\"$r\",\"CodeBlock\",null,{\"code\":\"nix.settings.substituters = [ \\\"{{http_protocol}}{{mirror}}/store\\\" ];\",\"codeLanguage\":\"nix\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"如果因为无法访问 \",[\"$r\",\"a\",null,{\"href\":\"https://cache.nixos.org\",\"rel\":\"nofollow\",\"children\":\"https://cache.nixos.org\"}],\" 等原因，希望避免自动添加该默认地址，请在配置中使用\",[\"$r\",\"code\",null,{\"children\":\"lib.mkForce\"}],\"。\"]}],\"\\n\",[\"$r\",\"CodeBlock\",null,{\"code\":\"# load `lib` into namespace at the file head with `{ config, pkgs, lib, ... }:`\\nnix.settings.substituters = lib.mkForce [ \\\"{{http_protocol}}{{mirror}}/store\\\" ];\",\"codeLanguage\":\"nix\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"临时使用\",\"children\":\"临时使用\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在安装 NixOS 时临时使用：\"}],\"\\n\",[\"$r\",\"CodeBlock\",null,{\"code\":\"nixos-install --option substituters \\\"{{http_protocol}}{{mirror}}/store https://cache.nixos.org\\\"\",\"codeLanguage\":\"shell\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在 NixOS 切换配置时临时使用：\"}],\"\\n\",[\"$r\",\"CodeBlock\",null,{\"code\":\"nixos-rebuild --option substituters \\\"{{http_protocol}}{{mirror}}/store https://cache.nixos.org\\\"\",\"codeLanguage\":\"shell\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"临时关闭可以通过还原 substituters 实现：\"}],\"\\n\",[\"$r\",\"SyntaxHighlight\",null,{\"code\":\"nixos-rebuild --option substituters \\\"https://cache.nixos.org\\\"\",\"language\":\"shell\"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"nixpkgs-channel\",\"children\":\"Nixpkgs channel\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"注：SJTUG 提供了 binary cache，未提供该镜像。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"单独安装的 Nix 替换 \",[\"$r\",\"code\",null,{\"children\":\"nixpkgs-unstable\"}],\" 命令如下：\"]}],\"\\n\",[\"$r\",\"CodeBlock\",null,{\"code\":\"nix-channel --add {{http_protocol}}{{mirror}}/nixpkgs-unstable nixpkgs\\nnix-channel --update\",\"codeLanguage\":\"bash\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"替换 NixOS channel 命令如下（以 root 执行）：\"}],\"\\n\",[\"$r\",\"CodeBlock\",null,{\"menus\":[{\"title\":\"系统版本\",\"items\":[[\"22.11\",{\"version\":\"22.11\"}],[\"unstable\",{\"version\":\"unstable\"}],[\"22.05\",{\"version\":\"22.05\"}],[\"21.11\",{\"version\":\"21.11\"}]]}],\"code\":\"nix-channel --add {{http_protocol}}{{mirror}}/nixos-{{version}} nixos\\nnix-channel --update\",\"codeLanguage\":\"bash\"}]]}]","meta":{"title":"Nix Channels 镜像使用帮助","cname":"nix-channels"},"cname":"nix-channels"},"__N_SSG":true}